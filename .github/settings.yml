# GitHub Repository Settings
# This file can be used with the Probot Settings app or as documentation
# for manual configuration in GitHub repository settings.
#
# To apply these settings:
# 1. Install the Probot Settings app: https://github.com/apps/settings
# OR
# 2. Manually configure in: Settings → Branches → Add rule (or Settings → Rules → Rulesets)

repository:
  # General repository settings
  name: safemap
  description: GIS-basert prosjekt som undersøker totalforsvaret i Norge
  homepage: https://github.com/MGumpen/safemap
  topics: gis, totalforsvar, norway, kartverket, geographic-information-system
  
  # Repository features
  has_issues: true
  has_projects: true
  has_wiki: true
  has_downloads: true
  
  # Default branch
  default_branch: main
  
  # Allow merge types
  allow_squash_merge: true
  allow_merge_commit: true
  allow_rebase_merge: true
  
  # Automatically delete head branches after PR merge
  delete_branch_on_merge: true

# Branch protection rules for main branch
branches:
  - name: main
    # Branch protection settings
    protection:
      # Require status checks to pass before merging
      required_status_checks:
        # Require branches to be up to date before merging
        strict: true
        # List of required status checks (must match job names in workflows)
        contexts:
          - "build-and-test (3.10)"
          - "build-and-test (3.11)"
          - "build-and-test (3.12)"
          - "security-scan"
      
      # Require pull request reviews before merging
      required_pull_request_reviews:
        # Number of required approving reviews
        required_approving_review_count: 1
        # Dismiss stale pull request approvals when new commits are pushed
        dismiss_stale_reviews: true
        # Require review from Code Owners
        require_code_owner_reviews: false
        # Restrict who can dismiss pull request reviews
        dismissal_restrictions:
          users: []
          teams: []
      
      # Require signed commits
      require_signed_commits: false
      
      # Require linear history (no merge commits)
      required_linear_history: false
      
      # Include administrators in restrictions
      enforce_admins: false
      
      # Restrict who can push to matching branches
      restrictions:
        users: []
        teams: []
        apps: []
      
      # Allow force pushes
      allow_force_pushes: false
      
      # Allow deletions
      allow_deletions: false

  # Optional: Protection for develop branch
  # Note: develop branch has lighter requirements to allow faster iteration
  # Only Python 3.12 (latest) is required for develop, while main requires all versions
  - name: develop
    protection:
      required_status_checks:
        strict: false
        contexts:
          - "build-and-test (3.12)"
          - "security-scan"
      
      required_pull_request_reviews:
        required_approving_review_count: 1
        dismiss_stale_reviews: false
      
      enforce_admins: false
      allow_force_pushes: false
      allow_deletions: false
